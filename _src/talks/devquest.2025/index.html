<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="utf-8">
	<title>L‚Äôinvasion du HTML mutant</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="L‚Äôinvasion du HTML mutant ‚Äî conf√©rence donn√©e par Ga√´l Poupard lors du DevQuest Niort 2025.">
	<meta name="author" content="Ga√´l Poupard">
	<link rel="icon" href="../favicon.svg" type="image/svg+xml">
	<link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="../accesslide/fonts/bello-pro.woff2">
	<link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="../accesslide/fonts/museo-slab-300.woff2">
	<link rel="stylesheet" href="sliide.css" type="text/css" media="screen">
</head>
<body>
<main role="main" tabindex="0">
	<section id="slide-1" data-note="5m" class="splash d-flex flex-column justify-between">
		<h1>L‚Äôinvasion du <abbr title="HyperText Markup Language">html</abbr><br>mutant</h1>
		<dl class="d-flex m-auto">
			<dt>Slides en ligne</dt>
			<dd><a href="https://www.ffoodd.fr/devquest.2025/">ffoodd.fr/devquest.2025/</a></dd>
		</dl>
		<footer>
			<div class="d-flex">
				<p class="my-0">Anim√© par <a href="https://www.ffoodd.fr">Ga√´l Poupard</a></p>
				<ul role="list">
					<li><a href="https://www.ffoodd.fr">
						<img src="../accesslide/img/ffoodd.svg" alt="Blog de Ga√´l Poupard" height="32" width="32">
					</a></li>
					<li><a href="https://mamot.fr/@ffoodd">
						<img src="../accesslide/img/mastodon.svg" alt="@ffoodd sur Mastodon" height="32" width="32">
					</a></li>
					<li><a href="https://github.com/ffoodd/">
						<img src="../accesslide/img/github.svg" alt="@ffoodd sur Github" height="32" width="32">
					</a></li>
					<li><a href="https://www.linkedin.com/in/ga%C3%ABl-poupard-40117b30/">
						<img src="../accesslide/img/linkedin.svg" alt="Ga√´l Poupard sur Linkedin" height="32" width="32">
					</a></li>
					<li><a href="https://www.paris-web.fr/">
						<img src="../accesslide/img/pw.svg" alt="Paris Web" height="32" width="32">
					</a></li>
				</ul>
			</div>
			<p>
				<a href="https://www.groupeonepoint.com">
					<img src="onepoint.svg" width="166" height="80" alt="onepoint">
				</a>
			</p>
		</footer>
	</section>

	<section id="slide-2" data-note="Xm">
		<h2>Niveau 0<br>L‚Äôinspecteur</h2>
		<p class="lead">C‚Äôest notre h√©ros du jour&nbsp;: invoquez-le avec <kbd>F12</kbd>.</p>
		<div class="grid-2">
			<div class="portrait" aria-hidden="true">üïµüèø</div>
			<div class="carte">
				<p>L‚Äôinspecteur d√©veloppe un site web, et tout se passe pour le mieux.</p>
				<p>
					Mais au moment de faire un audit d‚Äôaccessibilit√©, le DOM est sens dessus dessous
					et des scripts tiers font n‚Äôimporte quoi&nbsp;!
				</p>
				<p>Ni une, ni deux&nbsp;: l‚Äôinspecteur d√©gaine ses outils, il faut corriger le tir&nbsp;!</p>
			</div>
		</div>
	</section>

	<section id="slide-3" data-note="Xm">
		<h2>Niveau 0<br>Les outils</h2>
		<div>
			<p class="lead">L‚Äôinspecteur n‚Äôa pas de flingue, il a une API&nbsp;!</p>
			<p>Pour r√©parer le DOM, nous allons nous servir d‚Äôun <code>MutationObserver</code>.</p>
			<p class="mb-0">Quelques r√®gles&nbsp;:</p>
		</div>
		<div class="grid-2">
			<div>
				<ol>
					<li>Il faut l‚Äôinstancier.</li>
					<li>Il faut lui donner une cible.</li>
					<li>Il lui faut une fonction de rappel.</li>
					<li>Il faut le d√©brancher, √† un moment.</li>
				</ol>
				<p>Et maintenant, en avant&nbsp;!</p>
			</div>
			<pre class="playground pt-0"><code>const observer = new MutationObserver();
observer.observe(
	document.querySelector('#cible'),
	callback
);
observer.disconnect();
		</code></pre>
		</div>
	</section>

	<section id="slide-4" data-note="Xm">
		<h2>Niveau 1<br>Le zombie</h2>
		<div class="grid-2">
			<div class="portrait" aria-hidden="true">
				<mu-tant type="zombie"></mu-tant>
			</div>
			<div>
				<h3>Entrons dans le vif du sujet&nbsp;: les changements d‚Äôattribut</h3>
				<p>
					Avez-vous d√©j√† eu besoin de d√©clencher quelque chose en JavaScript
					lorsqu‚Äôun √©l√©ment change d‚Äôattribut&nbsp;?
				</p>
				<p class="small">
					Songez √† tous ces attributs qui peuvent √™tre importants&nbsp;:
					<code>hidden</code>, <code>aria-label</code>, <code>aria-invalid</code>‚Ä¶
				</p>
			</div>
		</div>
	</section>

	<section id="slide-5" class="demo" data-note="attributes: true">
		<h2 role="presentation">Niveau 1<br>Le zombie</h2>
		<div class="markup">
			<code-runner type="json">
				<form>
					<label for="options-zombie" class="sr-only">
						Options de la m√©thode <code>observe()</code>, dont le premier argument
						est <code>document.querySelector("mu-tant")</code>.
					</label>
					<pre role="presentation"><code>observer.observe(document.querySelector("mu-tant"), {</code></pre>
					<input type="text" name="options"
								 id="options-zombie"
								 autocomplete="off"
								 autocorrect="off"
								 autocapitalize="none"
								 spellcheck="false"
								 enterkeyhint="send"
								 list="attributes"
								 required>
					<datalist id="attributes">
						<option>attributes: true</option>
					</datalist>
					<pre role="presentation"><code>});</code></pre>
					<p><button>Feu&nbsp;!</button></p>
				</form>
			</code-runner>
		</div>
		<div class="playground">
			<play-ground type="zombie" max="1000" await></play-ground>
		</div>
	</section>

	<section id="slide-6" data-note="Xm">
		<h2>Niveau 2<br>Le super-vilain</h2>
		<p class="lead">Il n‚Äôy a pas que des gentils dans la vie.</p>
		<div class="grid-2">
			<div class="portrait" aria-hidden="true">
				<mu-tant type="villain"></mu-tant>
			</div>
			<div>
				<h3>Cas d‚Äôusage&nbsp;: les changements textuels</h3>
				<p>
					Avez-vous d√©j√† eu besoin de d√©clencher quelque chose en JavaScript
					lorsque le contenu textuel d‚Äôun √©lement change&nbsp;?
				</p>
				<p class="small">
					Imaginez un peu&nbsp;: un bouton dont l‚Äôintitul√© change, mais pas d‚Äô√©tat ni de classe auxquels s‚Äôaccrocher&nbsp;?
					Ou mieux, vous faites vos <i lang="en">slides</i> en HTML, avec une vue pr√©sentateur que vous
					voulez synchroniser sur votre pagination.
				</p>
			</div>
		</div>
	</section>

	<section id="slide-7" class="demo" data-note="characterData: true">
		<h2 role="presentation">Niveau 2<br>Le super-vilain</h2>
		<div class="markup">
			<code-runner type="json">
				<form>
					<label for="options-villain" class="sr-only">
						Options de la m√©thode <code>observe()</code>, dont le premier argument
						est <code>document.querySelector("mu-tant")</code>.
					</label>
					<pre role="presentation"><code>observer.observe(document.querySelector("mu-tant"), {</code></pre>
					<input type="text" name="options"
								 id="options-villain"
								 autocomplete="off"
								 autocorrect="off"
								 autocapitalize="none"
								 spellcheck="false"
								 enterkeyhint="send"
								 list="character-data"
								 required>
					<datalist id="character-data">
						<option>characterData: true</option>
					</datalist>
					<pre role="presentation"><code>});</code></pre>
					<p><button>Feu&nbsp;!</button></p>
				</form>
			</code-runner>
		</div>
		<div class="playground">
			<play-ground type="villain" max="1000" await></play-ground>
		</div>
	</section>

	<section id="slide-8" data-note="Xm">
		<h2>Niveau 3<br>L‚Äôalien</h2>
		<p class="lead">Ils sont parmi nous&nbsp;!</p>
		<div class="grid-2">
			<div class="portrait" aria-hidden="true">
				<mu-tant type="invaders"></mu-tant>
			</div>
			<div>
				<h3>Cas d‚Äôusage&nbsp;: les changements de descendance directe</h3>
				<p>
					Un contenu inject√© inopin√©ment ‚Äî&nbsp;au hasard,
					lors d‚Äôun <i lang="en">scroll</i> infini, un script tiers
					qui injecte tout seul son DOM‚Ä¶&nbsp;‚Äî c‚Äôest irritant&nbsp;!
				</p>
				<p>
					Ou encore&nbsp;: une <code>iframe</code>
					dont vous devriez ajuster la hauteur en fonction de son contenu‚Ä¶
				</p>
				<p class="small">Ceci n‚Äôest pas inspir√© de faits r√©els, √©videmment&nbsp;!</p>
			</div>
		</div>
	</section>

	<section id="slide-9" class="demo" data-note="childList: true">
		<h2 role="presentation">Niveau 3<br>L‚Äôalien</h2>
		<div class="markup">
			<code-runner type="json">
				<form>
					<label for="options-alien" class="sr-only">
						Options de la m√©thode <code>observe()</code>, dont le premier argument
						est <code>document.querySelector("mu-tant")</code>.
					</label>
					<pre role="presentation"><code>observer.observe(document.querySelector("mu-tant"), {</code></pre>
					<input type="text" name="options"
								 id="options-alien"
								 autocomplete="off"
								 autocorrect="off"
								 autocapitalize="none"
								 spellcheck="false"
								 enterkeyhint="send"
								 list="child-list"
								 required>
					<datalist id="child-list">
						<option>childList: true</option>
					</datalist>
					<pre role="presentation"><code>});</code></pre>
					<p><button>Feu&nbsp;!</button></p>
				</form>
			</code-runner>
		</div>
		<div class="playground">
			<play-ground type="invaders" max="1000" await></play-ground>
		</div>
	</section>

	<section id="slide-10" data-note="Xm">
		<h2>Niveau 4<br>Le fant√¥me</h2>
		<p class="lead">Vous n‚Äôavez pas entendu un truc&nbsp;?</p>
		<div class="grid-2">
			<div class="portrait" aria-hidden="true">
				<mu-tant type="ghost"></mu-tant>
			</div>
			<div>
				<h3>Cas d‚Äôusage&nbsp;: un attribut pr√©cis change pour une valeur sp√©cifique</h3>
				<p>
					Imaginez un <i lang="en">framework</i> qui indique l‚Äô√©tat invalide d‚Äôun champ de formulaire
					avec une classe, mais sans <code>aria-invalid</code>&nbsp;? Vous savez comment <i lang="en">patcher</i> √ßa,
					maintenant.
				</p>
				<p class="small">Toute ressemblance avec des <i lang="en">frameworks</i> serait purement fortuite.</p>
			</div>
		</div>
	</section>

	<section id="slide-11" class="demo" data-note="attributeFilter: ['id']">
		<h2 role="presentation">Niveau 4<br>Le fant√¥me</h2>
		<div class="markup">
			<code-runner type="json">
				<form>
					<label for="options-ghost" class="sr-only">
						Options de la m√©thode <code>observe()</code>, dont le premier argument
						est <code>document.querySelector("mu-tant")</code>.
					</label>
					<pre role="presentation"><code>observer.observe(document.querySelector("mu-tant"), {</code></pre>
					<input type="text" name="options"
								 id="options-ghost"
								 autocomplete="off"
								 autocorrect="off"
								 autocapitalize="none"
								 spellcheck="false"
								 enterkeyhint="send"
								 minlength="18"
								 list="attribute-filter"
								 required>
					<datalist id="attribute-filter">
						<option>attributeFilter: ['id']</option>
					</datalist>
					<pre role="presentation"><code>});</code></pre>
					<p><button>Feu&nbsp;!</button></p>
				</form>
			</code-runner>
		</div>
		<div class="playground">
			<play-ground type="ghost" max="1000" await></play-ground>
		</div>
	</section>

	<section id="slide-12" data-note="Xm">
		<h2>Niveau 5<br>Le sorcier</h2>
		<p class="lead">Il faut se m√©fier des types encapuchonn√©s<br>avec un grand b√¢ton.</p>
		<div class="grid-2">
			<div class="portrait" aria-hidden="true">
				<mu-tant type="mage"></mu-tant>
			</div>
			<div>
				<h3>Cas d‚Äôusage&nbsp;: les changements de descendance profonde</h3>
				<p>
					Le saviez-vous&nbsp;? Un <i lang="en">Web Component</i> ne peut pas √©mettre un √©v√©nement en disparaissant‚Ä¶
					Donc si vous voulez d√©clencher quelque chose, vous saurez comment faire&nbsp;!
				</p>
				<p class="small">Toute ressemblance avec des <i lang="en">frameworks</i> serait purement fortuite.</p>
			</div>
		</div>
	</section>

	<section id="slide-13" class="demo" data-note="childList: true, subtree: true">
		<h2 role="presentation">Niveau 5<br>Le sorcier</h2>
		<div class="markup">
			<code-runner type="json">
				<form>
					<label for="options-mage" class="sr-only">
						Options de la m√©thode <code>observe()</code>, dont le premier argument
						est <code>document.querySelector("mu-tant")</code>.
					</label>
					<pre role="presentation"><code>observer.observe(document.querySelector("mu-tant"), {</code></pre>
					<input type="text" name="options"
								 id="options-mage"
								 autocomplete="off"
								 autocorrect="off"
								 autocapitalize="none"
								 spellcheck="false"
								 enterkeyhint="send"
								 minlength="18"
								 list="subtree"
								 required>
					<datalist id="subtree">
						<option>childList: true, subtree: true</option>
					</datalist>
					<pre role="presentation"><code>});</code></pre>
					<p><button>Feu&nbsp;!</button></p>
				</form>
			</code-runner>
		</div>
		<div class="playground">
			<play-ground type="mage" max="1000" await></play-ground>
		</div>
	</section>

	<section id="slide-14" data-note="Xm">
		<h2>Niveau 6<br>Le vampire</h2>
		<p class="lead">Il faut aussi se m√©fier des types avec un sourire qui d√©borde.</p>
		<div class="grid-2">
			<div class="portrait" aria-hidden="true">
				<mu-tant type="vampire"></mu-tant>
			</div>
			<div>
				<h3>Cas d‚Äôusage&nbsp;: les valeurs disparues</h3>
				<p>
					Vous avez connu l‚Äô√©poque des classes <code>.open</code> et <code>.show</code>
					pour afficher ou masquer un √©l√©ment ‚Äî&nbsp;et aucun autre changement dans le DOM&nbsp;?
					Ou un script tiers qui fait des trucs sans √©mettre d‚Äô√©v√©nements&nbsp;?
				</p>
				<p class="small">Bien entendu, ce sujet est une pure fiction.</p>
			</div>
		</div>
	</section>

	<section id="slide-15" class="demo" data-note="attributeOldValue: true\A0mutation.oldValue.includes('mutant')">
		<h2 role="presentation">Niveau 6<br>Le vampire</h2>
		<div class="markup">
			<code-runner type="json">
				<form>
					<label for="condition-vampire" class="sr-only">
						Condition √† remplir par une mutation pour supprimer la cible de la mutation
						et interrompre l‚Äôobservation.
					</label>
					<pre role="presentation"><code>const slayer = new MutationObserver(mutations => {
	for (const mutation of mutations) {
		if (										) {
			mutation.target.remove();
			slayer.disconnect();
		}
	}
});</code></pre>
					<input type="text" name="condition"
								 id="condition-vampire"
								 autocomplete="off"
								 autocorrect="off"
								 autocapitalize="none"
								 spellcheck="false"
								 enterkeyhint="send"
								 list="mutation-old-value"
								 required>
					<datalist id="mutation-old-value">
						<option>mutation?.oldValue?.includes('mutant')</option>
					</datalist>
					<label for="options-vampire" class="sr-only">
						Options de la m√©thode <code>observe()</code>, dont le premier argument
						est <code>document.querySelector("mu-tant")</code>.
					</label>
					<pre role="presentation"><code>slayer.observe(document.querySelector("mu-tant"), {</code></pre>
					<input type="text" name="options"
								 id="options-vampire"
								 autocomplete="off"
								 autocorrect="off"
								 autocapitalize="none"
								 spellcheck="false"
								 enterkeyhint="send"
								 list="attribute-old-value"
								 required>
					<datalist id="attribute-old-value">
						<option>attributeOldValue: true</option>
					</datalist>
					<pre role="presentation"><code>});</code></pre>
					<p><button>Feu&nbsp;!</button></p>
				</form>
			</code-runner>
		</div>
		<div class="playground">
			<play-ground type="vampire" max="1000" await></play-ground>
		</div>
	</section>

	<section id="slide-16" data-note="Xm">
		<h2>Niveau 7<br>Le vieillissement</h2>
		<p class="lead">Vous ne l‚Äôaviez pas vu venir, hein&nbsp;?</p>
		<div class="grid-2">
			<div class="portrait" aria-hidden="true">
				<mu-tant type="skull"></mu-tant>
			</div>
			<div>
				<h3>Cas d‚Äôusage&nbsp;: les caract√®res disparus</h3>
				<p>
					Un composant de cr√©ation de mot de passe qui enl√®ve la description des contraintes franchies‚Ä¶
				</p>
				<p class="small">Vous n‚Äôavez jamais vu √ßa&nbsp;?</p>
			</div>
		</div>
	</section>

	<section id="slide-17" class="demo" data-note="characterDataOldValue: true\A0mutation.oldValue === 'üíÄ'">
		<h2 role="presentation">Niveau 7<br>Le vieillissement</h2>
		<div class="markup">
			<code-runner type="json">
				<form>
					<label for="condition-skull" class="sr-only">
						Condition √† remplir par une mutation pour supprimer la cible de la mutation
						et interrompre l‚Äôobservation.
					</label>
					<pre role="presentation"><code>const death = new MutationObserver(mutations => {
	for (const mutation of mutations) {
		if (									) {
			mutation.target.remove();
			death.disconnect();
		}
	}
});</code></pre>
					<input type="text" name="condition"
								 id="condition-skull"
								 autocomplete="off"
								 autocorrect="off"
								 autocapitalize="none"
								 spellcheck="false"
								 enterkeyhint="send"
								 list="character-data-old-value"
								 required>
					<datalist id="character-data-old-value">
						<option>mutation?.oldValue === 'üíÄ'</option>
					</datalist>
					<label for="options-skull" class="sr-only">
						Options de la m√©thode <code>observe()</code>, dont le premier argument
						est <code>document.querySelector("mu-tant")</code>.
					</label>
					<pre role="presentation"><code>death.observe(document.querySelector("mu-tant"), {</code></pre>
					<input type="text" name="options"
								 id="options-skull"
								 autocomplete="off"
								 autocorrect="off"
								 autocapitalize="none"
								 spellcheck="false"
								 enterkeyhint="send"
								 list="mutation-old-char"
								 required>
					<datalist id="mutation-old-char">
						<option>characterDataOldValue: true</option>
					</datalist>
					<pre role="presentation"><code>});</code></pre>
					<p><button>Feu&nbsp;!</button></p>
				</form>
			</code-runner>
		</div>
		<div class="playground">
			<play-ground type="skull" max="1000" await></play-ground>
		</div>
	</section>

	<section id="slide-18" data-note="8m">
		<h2>Niveau 8<br>Le boss final</h2>
		<p class="lead">C‚Äôest le moment de sauver des vies.</p>
		<div class="grid-2">
			<div class="portrait" aria-hidden="true">üéÜ</div>
			<div>
				<h3>La fonction de rappel dispose aussi de pouvoirs.</h3>
				<p>
					Jusqu‚Äô√† pr√©sent, j‚Äôai savamment supprim√© l‚Äô√©l√©ment mutant&nbsp;:
					mais comment faire si on veut trier, filtrer‚Ä¶ bref, tenir compte du contexte&nbsp;?
				</p>
			</div>
		</div>
	</section>

	<section id="slide-19" class="demo" data-note="5m">
		<h2 role="presentation">Niveau 8<br>Le boss final</h2>
		<div class="markup">
			<code-runner type="callback">
				<form>
					<label for="fonction" class="sr-only">
						Code JavaScript √† d√©clencher dans la fonction de rappel pour chaque mutation,
						avec pour objectif de supprimer les mutants.
					</label>
					<pre role="presentation"><code>const death = new MutationObserver(mutations => {
	for (const mutation of mutations) {</code></pre>
					<textarea id="fonction"
										autocomplete="off"
										autocorrect="off"
										autocapitalize="none"
										spellcheck="false"
										enterkeyhint="send"
										required></textarea>
					<pre role="presentation"><code>	}
});</code></pre>
					<p><button>Feu&nbsp;!</button></p>
				</form>
			</code-runner>
		</div>
		<div class="playground">
			<play-ground type="all" max="1000" await></play-ground>
		</div>
	</section>

	<section id="slide-20" data-note="5m">
		<h2>Niveau 8<br>Les solutions</h2>
		<h3>Le bazooka</h3>
		<pre><code>document.querySelectorAll('mu-tant:not([type=""])')
	.forEach(mutant => mutant.remove());</code></pre>
		<h3>Le pr√©cautionneux</h3>
		<pre><code>if (mutation.target.nodeName === 'MU-TANT' && mutation.target.type !== '') {
	mutation.target.remove();
} else if (mutation.target.closest('mu-tant') !== undefined) {
	mutation.target.closest('mu-tant').remove();
}</code></pre>
		<p>
			Malgr√© toutes les options, on peut avoir du mal √† trier les mutations.
			Fort √† propos, le type <code>MutationRecord</code> dispose de tout un tas de propri√©t√©s bien utiles.
		</p>
	</section>

	<section id="slide-21">
		<h2>Niveau bonus<br>Mais encore&nbsp;?</h2>
		<p class="lead">Les <code>MutationObserver</code> ne sont pas seuls&nbsp;!</p>
		<ul>
			<li>
				Les <code>IntersectionObserver</code> permettent de surveiller les collisions
				visuelles entre √©l√©ments&nbsp;;
			</li>
			<li>
				Les <code>ResizeObserver</code> permettent de surveiller les changements
				de dimensions d‚Äôun √©l√©ment&nbsp;;
			</li>
			<li>
				Les <code>PerformanceObserver</code> permettent de surveiller diff√©rents
				indicateurs de performance et de les consigner dans les <i lang="en">logs</i>.
			</li>
		</ul>
	</section>

	<section id="slide-22">
		<h2>G√©n√©rique de fin<br>Merci</h2>
		<p class="lead">
			D√©couvrez <a href="../devfest.2024/jeu/">le jeu r√©alis√© pour le
			dernier devFest Nantes</a>&nbsp;!
		</p>
		<div class="grid-2">
			<div>
				<h4>Cr√©dits</h4>
				<ul>
					<li>Typographie de titraille&nbsp;: <a hreflang="en" href="https://fonts.google.com/specimen/Luckiest+Guy?preview.text=Mutant&class&nbsp;;fication=Display,Handwriting&query=Astigmatic">Luckiest Guy</a> par Astigmatic&nbsp;;</li>
					<li>Typographie de labeur&nbsp;: <a hreflang="en" href="https://github.com/mozilla/zilla-slab">Zilla Slab</a> par Mozilla&nbsp;;</li>
					<li>Typographie monospace&nbsp;: <a hreflang="en" href="https://blog.glyphdrawing.club/font-with-built-in-syntax-highlighting/">FontWithASyntaxHighlighter</a> par Heikki Lotvonen&nbsp;;</li>
					<li>Typographie pour les √©mojis&nbsp;: <a hreflang="en" href="https://github.com/mozilla/twemoji-colr">Twemoji COLR</a> par Mozilla.</li>
					<li>Moteur de pr√©sentation inspir√© de <a hreflang="en" href="https://css-tricks.com/css-scroll-snap-slide-deck/">"<cite lang="en">CSS scroll-snap slide deck that supports live coding</cite>" de Stephanie Eckles sur Smashing Magazine</a>.</li>
				</ul>
			</div>
			<div class="m-auto">
				<h4>Laissez votre <i lang="en">feedback</i></h4>
				<p><a href="https://www.devquest.fr/sessions/linvasion-du-html-mutant">
					<img src="qr.svg" alt="Openfeedback" width="400" height="400" loading="lazy">
				</a></p>
			</div>
		</div>
	</section>
</main>

<dialog id="portal" role="dialog" aria-labelledby="portal-heading">
	<h2 id="portal-heading">Bien jou√©&nbsp;!</h2>
	<p>Un cas tordu de moins&nbsp;: on passe au suivant&nbsp;?</p>
	<form method="dialog">
		<button>Continuer</button>
	</form>
</dialog>
<dialog id="game-over" role="dialog" aria-labelledby="game-over-heading">
	<h2 id="game-over-heading" lang="en">Game over</h2>
	<p>
		Vous avez √©t√© submerg√©&nbsp;! Pour vous √©pargner (et √©vider de faire fondre votre navigateur),
		vous √™tes pri√©s de recommencer le niveau‚Ä¶
	</p>
	<form method="dialog">
		<button>Rejouer</button>
	</form>
</dialog>
<dialog id="replay" role="dialog" aria-labelledby="replay-heading">
	<h2 id="replay-heading">Rat√©&nbsp;!</h2>
	<p>
		Vos options n‚Äôont pas fonctionn√©‚Ä¶ Nouvelle chance&nbsp;?
	</p>
	<form method="dialog">
		<button>Rejouer</button>
	</form>
</dialog>

<div class="timer" style="--duration: 45;">
	<div class="clock" role="presentation">
		<span style="--time: 3600s"></span>h&nbsp;
		<span style="--time: 60s"></span>m&nbsp;
		<span style="--time: 1s"></span>s
	</div>
</div>

<script src="../devfest.2024/jeu/mu-tant.js"></script>
<script src="../devfest.2024/jeu/code-runner.js"></script>
<script src="../devfest.2024/jeu/play-ground.js"></script>
<script>
	let view;
	switchSlide = (id) => {
		// Historique
		history.pushState({}, '', `#slide-${id}`);
		// Vue pr√©sentateur
		//// Aper√ßu du slide suivant
		document.body.style.setProperty('--next', String(`-moz-element(#slide-${Number(id) + 1})`));
		//// Synchro de la vue pr√©sentateur
		if (view) {
			view.postMessage(`slide-${id}`, `http://localhost:8080${document.location.pathname}index.html`);
		}
		//// Notes dans la vue pr√©sentateur
		if('note' in document.getElementById(`slide-${id}`).dataset) {
			document.body.dataset.note = document.getElementById(`slide-${id}`).dataset.note;
		} else {
			delete document.body.dataset.note;
		}
	}

	document.addEventListener('DOMContentLoaded', () => {
		const slides = document.querySelectorAll('section[id^="slide-"]');

		// Nombre total de slides, pour la pagination
		document.body.style.setProperty('--slides', String(slides.length));
		document.body.style.setProperty('--next', String(`-moz-element(#slide-2)`));

		// Gestion de l‚Äôhistorique
		let io = new IntersectionObserver(entries => {
			if (entries[0].isIntersecting === true) {
				switchSlide(entries[0].target.id.split('-')[1]);
			}
		}, {
			root: document.querySelector('main'),
			threshold: [1]
		});
		slides.forEach(slide =>	io.observe(slide));

		document.addEventListener('keydown', event => {
			const index = Number(window.location.hash.split('-')[1]);
			let id = null;
			switch (event.key) {
				// Activer la vue pr√©sentateur
				case 's':
					if (event.altKey) {
						view = window.open(`http://localhost:8080${document.location.pathname}index.html`, 'speakerView');
						view.addEventListener('load', () => {
							view.document.body.classList.add('speaker');
						})
					}
					break;
				// T√©l√©commande ++
				case 'PageDown':
					id = index + 1;
					break;
				// T√©l√©commande --
				case 'PageUp':
					id = index - 1;
					break;
				default:
					break;
			}

			if (id !== null && id >= 1) {
				document.getElementById(`slide-${id}`).scrollIntoView({ behavior: 'smooth' });
				switchSlide(id);
			}
		});
	});

	window.addEventListener('message', (e) => {
		if (e.origin === 'http://localhost:8080' && typeof e.data === 'string') {
			document.getElementById(e.data)?.scrollIntoView({ behavior: 'smooth' });
			switchSlide(e.data?.split('-')[1]);
		}
	}, false);
</script>
</body>
</html>
