<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Avec ou sans JS&amp;nbsp;? — La vie en #ffoodd</title>
		<meta name="description" content="J&amp;apos;arrive sur la page… Hop&amp;nbsp;! Le menu vient de se cacher&amp;nbsp;! J&amp;apos;ai du l&amp;apos;effrayer…">
		<link rel="icon" href="/favicon.svg" type="image/svg+xml">
		<link rel="stylesheet" href="/assets/styles.min.css" media="all">
		<link rel="stylesheet" href="/assets/impression.min.css" media="print">
		<!-- @todo Ajouter le flux RSS
			<link rel="alternate" type="application/rss+xml" title="La vie en #ffoodd | Flux RSS" href="/feed/">
		-->
	</head>
	<body class="tk-museo-slab" itemscope itemtype="https://schema.org/WebPage">
		<a class="skip scroll pa1 inbl smaller print-hidden" href="#content">Aller au contenu</a>
		<div class="row">
			<nav class="col txtright pt8 w-33 pl0 pr0 print-hidden" id="nav" role="navigation">
				<ul class="menu aside p-reset m-reset ul-reset">
					<li class="tk-bello-pro h1-like m-reset">
						<a href="/">ffoodd</a>
					</li>
					<li class="h3-like m-reset">
						<a href="/plus/">À propos</a>
					</li>
					<!-- @todo gérer l’URL ? Une redirection ? -->
					<li class="h3-like m-reset">
						<a href="/category/journal/">Journal</a>
					</li>
					<li class="h3-like m-reset">
						<a href="/travaux/">Parcours</a>
					</li>
				</ul>
			</nav>

			<main class="col w--site pl3 pb3 pr5" id="content" role="main" role="main" itemprop="mainContentOfPage">
				<div class="logo print-hidden">
					<img src="/assets/img/embossed-ffoodd.png" alt="La vie en #ffoodd" id="logo" width="144" height="144">
				</div>
				<article role="article" itemscope itemtype="https://schema.org/Article">
				
					<header class="center pt1 mb1" role="banner">
						<h1 class="mb0 mt0 tk-bello-pro" itemprop="name">Avec ou sans JS&amp;nbsp;?</h1>
						
	<nav role="navigation" aria-labelledby="here" class="print-hidden small mt2 mb1">
		<span id="here">Vous êtes ici&nbsp;: </span>
		<div class="inbl" itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
			<a href="/" itemprop="url"><span itemprop="title">La vie en #ffoodd</span></a>
			<span> ›&nbsp;</span>
		</div><div class="inbl" itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
			<a href="/journal/" itemprop="url"><span itemprop="title">Journal</span></a>
			<span> ›&nbsp;</span>
		</div><div class="inbl" itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
			<span itemprop="title">Avec ou sans JS&amp;nbsp;?</span>
		</div>
	</nav>

						
							<h2 class="h3-like description" itemprop="description">J&apos;arrive sur la page… Hop&nbsp;! Le menu vient de se cacher&nbsp;! J&apos;ai du l&apos;effrayer…</h2>
						
					</header>
					
	<time class="screen-reader-text" datetime="2017-02-03T17:02:05" itemprop="datePublished">3 février 2017</time>
	<div itemprop="articleBody">
		<p>Vous avez déjà vécu ça, pas vrai ?</p>
<h2 id="l%E2%80%99am%C3%A9lioration-progressive" tabindex="-1">L’amélioration progressive</h2>
<p>Quand on cherche à bien faire ces interactions qui affichent et masquent un élément à l’aide de JavaScript, une des fondations est de <strong>s’assurer que le contenu soit accessible sans JavaScript</strong>. Ça fait partie intégrante de l’amélioration progressive, que je synthétise comme suit :</p>
<ol>
<li>le HTML est propre, lisible, cohérent, et permet d’<strong>accéder au contenu sans obstacle</strong> ;</li>
<li>le CSS améliore <strong>l’aspect graphique</strong>, ordonne les éléments visuellement ;</li>
<li>le JS enrichit le tout d’une couche de <strong>comportements</strong> inexistants en HTML et CSS.</li>
</ol>
<p>Or dans le cas d’un composant qui affiche ou masque un élément, le fonctionnement avant l’exécution du JS est donc d’avoir cet élément affiché par défaut. Ensuite — <strong>et seulement une fois que le JS est fonctionnel</strong> — on va pouvoir le manipuler pour masquer notre élément.</p>
<p>C’est là où le bât blesse. <strong>Le temps que notre JS soit exécuté, nous voyons l’élément affiché</strong> (même si ça ne dure qu’une fraction de seconde).</p>
<h2 id="la-limite-du-js" tabindex="-1">La limite du JS</h2>
<p>En l’occurrence, c’est son temps d’exécution — extrêmement dépendant de la machine et du navigateur de l’utilisateur.<br>
Plusieurs pistes existent pour palier ce problème :</p>
<ol>
<li>on peut par exemple <strong>exécuter le plus tôt possible</strong> le test d’activation du JS, qui consiste à transformer une classe <code>no-js</code> posée sur la balise <code>&lt;html&gt;</code>… Mais dans certains cas, ce la ne suffit pas ;</li>
<li>on peut également <strong>abdiquer</strong> : après tout, plus aucun référentiel n’exige d’alternative à JS ;</li>
<li>on peut aussi se la jouer <em>old school</em> en <strong>dupliquant le contenu masqué</strong> dans une balise <code>&lt;noscript&gt;</code> — mais on ne se sent pas vraiment propre, après ça.</li>
</ol>
<p>Comme le signale Lionel dans les commentaires, conserver la modification des classes dès le <code>&lt;head&gt;</code> reste une étape incontournable pour optimiser ce mécanisme. Un exemple :</p>
<pre><code class="language-javascript">
document.documentElement.classList.remove(’no-js’);
document.documentElement.classList.add(’js’);
</code></pre>
<p>Et en bonus, <strong>on peut réfléchir et utiliser CSS</strong>.</p>
<h2 id="les-styles-%C3%A0-la-rescousse" tabindex="-1">Les styles à la rescousse</h2>
<p>La base du fonctionnement que je propose est l’astuce utilisée par <a href="https://www.nicolas-hoffmann.net/source/">Nicolas Hoffmann</a> sur <a href="https://a11y.nicolas-hoffmann.net/">ses composants jQuery accessibles</a>. <em>Grosso modo</em>, il effectue une transition sur <code>max-height</code> pour la partie animée, et sur <code>visibility</code> avec un délai pour <strong>masquer réellement</strong> le contenu.<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p>
<p>J’aime beaucoup cette technique, dont le seul inconvénient — à mon avis — est d’animer <code>max-height</code>, ce qui nous oblige à utiliser un <a href="https://www.ffoodd.fr/decouvrez-le-calcul-magique/">chiffre magique</a> pour une hauteur maximum inatteignable.</p>
<h3 id="l%E2%80%99%C3%A9tat-de-base" tabindex="-1">L’état de base</h3>
<p>Voici l’état de base de ma navigation :</p>
<pre><code class="language-css">[id=&quot;nav&quot;] {
  transform: translate3d(-100%, 0, 0);
  transition:
  transform 300ms ease-in 50ms,
  visibility 0s linear 300ms;
  visibility: hidden;
  width: 18.75rem;
  will-change: transform, visibility;
}
</code></pre>
<p>Elle est décalée vers la gauche de la totalité de sa largeur, afin de <strong>sortir de l’écran</strong> ; et est masquée.</p>
<p>Notez que nous avons un délai sur nos deux transitions. Pour le moment, seul celui sur <code>visibility</code> est important, puisqu’il permet de faire coïncider le changement de visibilité avec la durée de la transformation.</p>
<h3 id="l%E2%80%99ouverture-gr%C3%A2ce-%C3%A0-js" tabindex="-1">L’ouverture grâce à JS</h3>
<p>Là, c’est tout bête. Le JS ajoute une classe <code>.is-opened</code> à la navigation, je m’en sers pour accrocher mes styles :</p>
<pre><code class="language-css">
.is-opened {
  transform: none;
  transition-delay: 0ms;
  visibility: visible;
}
</code></pre>
<p>Et pour ceux qui me connaissent, je désamorce une question : je n’utilise pas <code>:not([aria-hidden])</code>, car cet attribut est ajouté <em>via</em> JS. Ainsi la navigation commencerait à apparaître au chargement, puis serait masquée après l’exécution du script — <strong>exactement le comportement qu’on cherche à corriger</strong>.</p>
<h3 id="et-si-js-est-d%C3%A9sactiv%C3%A9" tabindex="-1">Et si JS est désactivé</h3>
<p>C’est là qu’on rigole ! Lisez plutôt, je vous explique ensuite :</p>
<pre><code class="language-css">
@keyframes no-js {
  to {
  transform: none;
  transition-delay: 50ms, 0ms;
  visibility: visible;
  }
}

.no-js [id=&quot;nav&quot;] {
  animation: 300ms ease-in 300ms forwards no-js;
}
</code></pre>
<p>Dans un premier temps, je définis la règle <code>@keyframes</code> pour mon animation. Son seul contenu est <strong>l’état final</strong> : pas de translation, l’élément est visible, et les délais de transition sont ajustés. <a href="http://caniuse.com/#search=keyframes">En terme de support</a> on abandonne donc IE9 et ses aïeux, ainsi qu’Opéra Mini.</p>
<p>Dans un second temps, j’applique cette animation sur la navigation lorsque la balise <code>&lt;html&gt;</code> porte la classe <code>.no-js</code>. C’est sa classe par défaut, qui n’est retirée que si JS est activé.</p>
<p>Pour éviter que l’animation ne se joue pendant le chargement de la page, je lui intime l’ordre de <strong>patienter</strong> 300 millisecondes et de <strong>durer</strong> 300 millisecondes — soit un délai généralement suffisant pour que JS ait magouillé les classes sur <code>&lt;html&gt;</code>.</p>
<p>Et ceux qui ont déjà joué avec les animations le savent, elles reviennent par défaut à l’état initial (soit dans notre cas, le menu masqué). Bien sûr, ça ne va pas : j’ai donc précisé grâce au mot-clé <code>forwards</code> que l’animation devait <strong>conserver son état final</strong>.</p>
<p>Et voilà ! <strong>On profite en sus d’une bien jolie animation qui fait entrer notre navigation dans l’écran</strong> au lieu de la fuir. Et une page animée avec JS désactivé, je trouve ça cool. 🙂</p>
<h2 id="d%C3%A9monstration" tabindex="-1">Démonstration</h2>
<p>Si vous êtes curieux de voir ce que ça donne ou de jouer avec, j’ai monté un <a href="http://codepen.io/ffoodd/pen/apGqpQ">CodePen de démonstration</a> dans lequel vous pourrez lire le code.</p>
<p>Pour jouer avec le JS désactivé, vous devrez <a href="http://codepen.io/ffoodd/full/apGqpQ/">consulter la vue complète</a>.<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></p>
<ol class="footnotes-list small mt2 pt2 pb2">
<li id="fn1" class="footnote-item"><p>Il explique tout ça très bien dans la documentation de ses divers composants. <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p>CodePen affiche un bien joli message si vous désactivé JavaScript. <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
</ol>

	</div>
	<footer class="small mt2">
		<p class="pl2 mt0 pt1">
			Article rédigé par <strong itemprop="author"><span class="fn">Gaël Poupard</span></strong>.
			Modifié le <time class="updated" datetime="2017-02-06T12:42:12" itemprop="dateModified">6 février 2017</time>.
		</p>
	</footer>
	<!-- @todo Gérer les commentaires -->

				</article>
				
			</main>

			
	<aside class="col pt8 pl0 pr0 print-hidden" role="complementary">
		<div class="aside pl2 pt2">
			<h3 class="tk-bello-pro h2-like m-reset">Sommaire</h3>
			<div class="textwidget" >
        <ol><li><a href="#l%E2%80%99am%C3%A9lioration-progressive">L’amélioration progressive</a></li><li><a href="#la-limite-du-js">La limite du JS</a></li><li><a href="#les-styles-%C3%A0-la-rescousse">Les styles à la rescousse</a></li><li><a href="#d%C3%A9monstration">Démonstration</a></li></ol>
      </div>
		</div>
	</aside>

		</div>
		<footer class="mw--site mod txtcenter center" role="contentinfo" itemscope itemtype="https://schema.org/Person">
			<ul class="ffeeeedd--contact ul-reset p-reset mt0 print-hidden">
				<!-- @todo Fichier json pour les réseaux ? -->
				<li class="inbl pa1" itemscope itemprop="contactPoint">
					<a class="skip inbl ir ffeeeedd--sprite ffeeeedd--sprite__mastodon" href="https://mamot.fr/@ffoodd" itemprop="url" title="Gaël Poupard sur Mastodon">
						<span itemprop="name">Mastodon</span>
					</a>
				</li>
				<li class="inbl pa1" itemscope itemprop="contactPoint">
					<a class="skip inbl ir ffeeeedd--sprite ffeeeedd--sprite__github" href="https://github.com/ffoodd" itemprop="url" title="Gaël Poupard sur GitHub">
						<span itemprop="name">GitHub</span>
					</a>
				</li>
				<li class="inbl pa1" itemscope itemprop="contactPoint">
					<a class="skip inbl ir ffeeeedd--sprite ffeeeedd--sprite__dribble" href="https://dribbble.com/ffoodd" itemprop="url" title="Gaël Poupard sur Dribbble">
						<span itemprop="name">Dribbble</span>
					</a>
				</li>
				<li class="inbl pa1" itemscope itemprop="contactPoint">
					<a class="skip inbl ir ffeeeedd--sprite ffeeeedd--sprite__linkedin" href="https://www.linkedin.com/pub/ga%C3%ABl-poupard/30/17b/401" itemprop="url" title="Gaël Poupard sur LinkedIn">
						<span itemprop="name">LinkedIn</span>
					</a>
				</li>
				<li class="inbl pa1" itemscope itemprop="contactPoint">
					<a class="skip inbl ir ffeeeedd--sprite ffeeeedd--sprite__behance" href="https://www.behance.net/ffoodd" itemprop="url" title="Gaël Poupard sur Behance">
						<span itemprop="name">Behance</span>
					</a>
				</li>
				<li class="inbl pa1" itemscope itemprop="contactPoint">
					<a class="skip inbl ir ffeeeedd--sprite ffeeeedd--sprite__rss" href="/feed/" itemprop="url" title="La vie en #ffoodd | Flux RSS">
						<span itemprop="name">RSS</span>
					</a>
				</li>
			</ul>

			<small>
				&copy; 2018 La vie en #ffoodd &mdash; Design et intégration par <span itemprop="name">Gaël Poupard</span> &mdash; <a href="/mentions-legales/">Mentions légales</a>
				<br />
				Sauf mention contraire, l’ensemble du contenu est sous <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/fr/">Licence <abbr lang="en" title="Creative Commons">CC</abbr> <abbr lang="en" title="Attribution">BY</abbr>-<abbr lang="en" title="Non Commercial">NC</abbr>-<abbr lang="en" title="Share Alike">SA</abbr></a>.
			</small>

			<meta itemprop="jobTitle" content="Webdesigner et intégrateur web">
			<meta itemprop="worksFor" content="onepoint">
		</footer>
		<script src="/assets/script.min.js"></script>
	</body>
</html>
