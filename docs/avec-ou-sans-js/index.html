<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Avec ou sans JS&amp;nbsp;?</title>
		<meta name="description" content="">
		<link rel="icon" href="/favicon.svg" type="image/svg+xml">
		<!-- @todo Ajouter le flux RSS
			<link rel="alternate" type="application/rss+xml" title="La vie en #ffoodd | Flux RSS" href="/feed/">
		-->
	</head>
	<body class="tk-museo-slab" itemscope itemtype="https://schema.org/WebPage">
		<a class="skip scroll pa1 inbl smaller print-hidden" href="#content">Aller au contenu</a>
		<div class="row">
			<nav class="col txtright pt8 w-33 pl0 pr0 print-hidden" id="nav" role="navigation">
				<ul class="menu aside p-reset m-reset ul-reset">
					<!-- @todo GÃ©rer lâ€™Ã©tat current -->
					<li class="tk-bello-pro h1-like m-reset current-menu-item current_page_item">
						<a href="/" aria-current="page">ffoodd</a>
					</li>
					<li class="h3-like m-reset"><a href="/plus/">Ã€ propos</a></li>
					<!-- @todo gÃ©rer lâ€™URL ? -->
					<li class="h3-like m-reset"><a href="/category/journal/">Journal</a></li>
					<li class="h3-like m-reset"><a href="/travaux/">Parcours</a></li>
				</ul>
			</nav><!-- / #nav -->

			<main class="col w--site pl3 pb3 pr5" id="content" role="main" role="main" itemprop="mainContentOfPage">
				<div class="logo print-hidden">
					<img src="/images/2013/10/copy-cropped-ffoodd.png" alt="La vie en #ffoodd" id="logo" width="144" height="144">
				</div>
				
					<p>Vous avez dÃ©jÃ  vÃ©cu Ã§a, pas vraiÂ ?</p>
<h2>Lâ€™amÃ©lioration progressive</h2>
<p>Quand on cherche Ã  bien faire ces interactions qui affichent et masquent un Ã©lÃ©ment Ã  lâ€™aide de JavaScript, une des fondations est de <strong>sâ€™assurer que le contenu soit accessible sans JavaScript</strong>. Ã‡a fait partie intÃ©grante de lâ€™amÃ©lioration progressive, que je synthÃ©tise comme suitÂ :</p>
<ol>
<li>le HTML est propre, lisible, cohÃ©rent, et permet dâ€™<strong>accÃ©der au contenu sans obstacle</strong>Â ;</li>
<li>le CSS amÃ©liore <strong>lâ€™aspect graphique</strong>, ordonne les Ã©lÃ©ments visuellementÂ ;</li>
<li>le JS enrichit le tout dâ€™une couche de <strong>comportements</strong> inexistants en HTML et CSS.</li>
</ol>
<p>Or dans le cas dâ€™un composant qui affiche ou masque un Ã©lÃ©ment, le fonctionnement avant lâ€™exÃ©cution du JS est donc dâ€™avoir cet Ã©lÃ©ment affichÃ© par dÃ©faut. Ensuite â€”Â <strong>et seulement une fois que le JS est fonctionnel</strong>Â â€” on va pouvoir le manipuler pour masquer notre Ã©lÃ©ment.</p>
<p>Câ€™est lÃ  oÃ¹ le bÃ¢t blesse. <strong>Le temps que notre JS soit exÃ©cutÃ©, nous voyons lâ€™Ã©lÃ©ment affichÃ©</strong> (mÃªme si Ã§a ne dure quâ€™une fraction de seconde).</p>
<h2>La limite du JS</h2>
<p>En lâ€™occurrence, câ€™est son temps dâ€™exÃ©cution â€”Â extrÃªmement dÃ©pendant de la machine et du navigateur de lâ€™utilisateur.<br>
Plusieurs pistes existent pour palier ce problÃ¨meÂ :</p>
<ol>
<li>on peut par exemple <strong>exÃ©cuter le plus tÃ´t possible</strong> le test dâ€™activation du JS, qui consiste Ã  transformer une classe <code>no-js</code> posÃ©e sur la balise <code>&lt;html&gt;</code>â€¦ Mais dans certains cas, ce la ne suffit pasÂ ;</li>
<li>on peut Ã©galement <strong>abdiquer</strong>Â : aprÃ¨s tout, plus aucun rÃ©fÃ©rentiel nâ€™exige dâ€™alternative Ã  JSÂ ;</li>
<li>on peut aussi se la jouer <em>old school</em> en <strong>dupliquant le contenu masquÃ©</strong> dans une balise <code>&lt;noscript&gt;</code> â€”Â mais on ne se sent pas vraiment propre, aprÃ¨s Ã§a.</li>
</ol>
<p>Comme le signale Lionel dans les commentaires, conserver la modification des classes dÃ¨s le <code>&lt;head&gt;</code> reste une Ã©tape incontournable pour optimiser ce mÃ©canisme. Un exempleÂ :</p>
<pre><code class="language-javascript">
document.documentElement.classList.remove(â€™no-jsâ€™);
document.documentElement.classList.add(â€™jsâ€™);
</code></pre>
<p>Et en bonus, <strong>on peut rÃ©flÃ©chir et utiliser CSS</strong>.</p>
<h2>Les styles Ã  la rescousse</h2>
<p>La base du fonctionnement que je propose est lâ€™astuce utilisÃ©e par <a href="https://www.nicolas-hoffmann.net/source/">Nicolas Hoffmann</a> sur <a href="https://a11y.nicolas-hoffmann.net/">ses composants jQuery accessibles</a>. <em>Grosso modo</em>, il effectue une transition sur <code>max-height</code> pour la partie animÃ©e, et sur <code>visibility</code> avec un dÃ©lai pour <strong>masquer rÃ©ellement</strong> le contenu.[^1]</p>
<p>[^1]: Il explique tout Ã§a trÃ¨s bien dans la documentation de ses divers composants.</p>
<p>Jâ€™aime beaucoup cette technique, dont le seul inconvÃ©nient â€”Â Ã  mon avisÂ â€” est dâ€™animer <code>max-height</code>, ce qui nous oblige Ã  utiliser un <a href="https://www.ffoodd.fr/decouvrez-le-calcul-magique/">chiffre magique</a> pour une hauteur maximum inatteignable.</p>
<h3>Lâ€™Ã©tat de base</h3>
<p>Voici lâ€™Ã©tat de base de ma navigationÂ :</p>
<pre><code class="language-css">[id=&quot;nav&quot;] {
  transform: translate3d(-100%, 0, 0);
  transition:
  transform 300ms ease-in 50ms,
  visibility 0s linear 300ms;
  visibility: hidden;
  width: 18.75rem;
  will-change: transform, visibility;
}
</code></pre>
<p>Elle est dÃ©calÃ©e vers la gauche de la totalitÃ© de sa largeur, afin de <strong>sortir de lâ€™Ã©cran</strong>Â ; et est masquÃ©e.</p>
<p>Notez que nous avons un dÃ©lai sur nos deux transitions. Pour le moment, seul celui sur <code>visibility</code> est important, puisquâ€™il permet de faire coÃ¯ncider le changement de visibilitÃ© avec la durÃ©e de la transformation.</p>
<h3>Lâ€™ouverture grÃ¢ce Ã  JS</h3>
<p>LÃ , câ€™est tout bÃªte. Le JS ajoute une classe <code>.is-opened</code> Ã  la navigation, je mâ€™en sers pour accrocher mes stylesÂ :</p>
<pre><code class="language-css">
.is-opened {
  transform: none;
  transition-delay: 0ms;
  visibility: visible;
}
</code></pre>
<p>Et pour ceux qui me connaissent, je dÃ©samorce une questionÂ : je nâ€™utilise pas <code>:not([aria-hidden])</code>, car cet attribut est ajoutÃ© <em>via</em> JS. Ainsi la navigation commencerait Ã  apparaÃ®tre au chargement, puis serait masquÃ©e aprÃ¨s lâ€™exÃ©cution du script â€”Â <strong>exactement le comportement quâ€™on cherche Ã  corriger</strong>.</p>
<h3>Et si JS est dÃ©sactivÃ©</h3>
<p>Câ€™est lÃ  quâ€™on rigoleÂ ! Lisez plutÃ´t, je vous explique ensuiteÂ :</p>
<pre><code class="language-css">
@keyframes no-js {
  to {
  transform: none;
  transition-delay: 50ms, 0ms;
  visibility: visible;
  }
}

.no-js [id=&quot;nav&quot;] {
  animation: 300ms ease-in 300ms forwards no-js;
}
</code></pre>
<p>Dans un premier temps, je dÃ©finis la rÃ¨gle <code>@keyframes</code> pour mon animation. Son seul contenu est <strong>lâ€™Ã©tat final</strong>Â : pas de translation, lâ€™Ã©lÃ©ment est visible, et les dÃ©lais de transition sont ajustÃ©s. <a href="http://caniuse.com/#search=keyframes">En terme de support</a> on abandonne donc IE9 et ses aÃ¯eux, ainsi quâ€™OpÃ©ra Mini.</p>
<p>Dans un second temps, jâ€™applique cette animation sur la navigation lorsque la balise <code>&lt;html&gt;</code> porte la classe <code>.no-js</code>. Câ€™est sa classe par dÃ©faut, qui nâ€™est retirÃ©e que si JS est activÃ©.</p>
<p>Pour Ã©viter que lâ€™animation ne se joue pendant le chargement de la page, je lui intime lâ€™ordre de <strong>patienter</strong> 300 millisecondes et de <strong>durer</strong> 300 millisecondes â€”Â soit un dÃ©lai gÃ©nÃ©ralement suffisant pour que JS ait magouillÃ© les classes sur <code>&lt;html&gt;</code>.</p>
<p>Et ceux qui ont dÃ©jÃ  jouÃ© avec les animations le savent, elles reviennent par dÃ©faut Ã  lâ€™Ã©tat initial (soit dans notre cas, le menu masquÃ©). Bien sÃ»r, Ã§a ne va pasÂ : jâ€™ai donc prÃ©cisÃ© grÃ¢ce au mot-clÃ© <code>forwards</code> que lâ€™animation devait <strong>conserver son Ã©tat final</strong>.</p>
<p>Et voilÃ Â ! <strong>On profite en sus dâ€™une bien jolie animation qui fait entrer notre navigation dans lâ€™Ã©cran</strong> au lieu de la fuir. Et une page animÃ©e avec JS dÃ©sactivÃ©, je trouve Ã§a cool. ğŸ™‚</p>
<h2>DÃ©monstration</h2>
<p>Si vous Ãªtes curieux de voir ce que Ã§a donne ou de jouer avec, jâ€™ai montÃ© un <a href="http://codepen.io/ffoodd/pen/apGqpQ">CodePen de dÃ©monstration</a> dans lequel vous pourrez lire le code.</p>
<p>Pour jouer avec le JS dÃ©sactivÃ©, vous devrez <a href="http://codepen.io/ffoodd/full/apGqpQ/">consulter la vue complÃ¨te</a>.[^2]</p>
<p>[^2]: CodePen affiche un bien joli message si vous dÃ©sactivÃ© JavaScript.</p>

				
			</main>

			<aside class="col pt8 pl0 pr0 print-hidden" role="complementary">
				<div class="aside pl2 pt2">
					<h3 class="tk-bello-pro h2-like m-reset">Ã€ lire ailleurs</h3>
					<div class="textwidget">
						<ul>
							<li>
								<a href="https://openweb.eu.org/articles/du-consommateur-au-producteur">sur Openweb</a>
							</li>
							<li>
								<a href="https://www.alsacreations.com/livres/lire/1503-webgrids-structure-et-typographie-de-la-page-web.html">sur AlsacrÃ©ations</a>
							</li>
						</ul>
					</div>
					<h3 class="tk-bello-pro h2-like m-reset pt1">Ã€ regarder ailleurs</h3>
					<div class="textwidget">
						<ul>
							<li>
								<a href="https://www.paris-web.fr/2018/conferences/la-donnee-graphique-avec-html-et-css.php">Paris Web 2018</a>
							</li>
						</ul>
					</div>
				</div>
			</aside>

			<footer class="mw--site mod txtcenter center" role="contentinfo" itemscope itemtype="https://schema.org/Person">
				<ul class="ffeeeedd--contact ul-reset p-reset mt0 print-hidden">
					<li class="inbl pa1" itemscope itemprop="contactPoint">
						<a class="skip inbl ir ffeeeedd--sprite ffeeeedd--sprite__github" href="https://github.com/ffoodd" itemprop="url" title="GaÃ«l Poupard sur GitHub">
							<span itemprop="name">GitHub</span>
						</a>
					</li>
					<li class="inbl pa1" itemscope itemprop="contactPoint">
						<a class="skip inbl ir ffeeeedd--sprite ffeeeedd--sprite__dribble" href="https://dribbble.com/ffoodd" itemprop="url" title="GaÃ«l Poupard sur Dribbble">
							<span itemprop="name">Dribbble</span>
						</a>
					</li>
					<li class="inbl pa1" itemscope itemprop="contactPoint">
						<a class="skip inbl ir ffeeeedd--sprite ffeeeedd--sprite__linkedin" href="https://www.linkedin.com/pub/ga%C3%ABl-poupard/30/17b/401" itemprop="url" title="GaÃ«l Poupard sur LinkedIn">
							<span itemprop="name">LinkedIn</span>
						</a>
					</li>
					<li class="inbl pa1" itemscope itemprop="contactPoint">
						<a class="skip inbl ir ffeeeedd--sprite ffeeeedd--sprite__behance" href="https://www.behance.net/ffoodd" itemprop="url" title="GaÃ«l Poupard sur Behance">
							<span itemprop="name">Behance</span>
						</a>
					</li>
					<li class="inbl pa1" itemscope itemprop="contactPoint">
						<a class="skip inbl ir ffeeeedd--sprite ffeeeedd--sprite__rss" href="/feed/" itemprop="url" title="La vie en #ffoodd | Flux RSS">
							<span itemprop="name">RSS</span>
						</a>
					</li>
				</ul>

				<small>
					&copy; 2018 La vie en #ffoodd &mdash; Design et intÃ©gration par <span itemprop="name">GaÃ«l Poupard</span> &mdash; <a href="/mentions-legales/">Mentions lÃ©gales</a>
					<br />
					Sauf mention contraire, lâ€™ensemble du contenu est sous <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/fr/">Licence <abbr lang="en" title="Creative Commons">CC</abbr> <abbr lang="en" title="Attribution">BY</abbr>-<abbr lang="en" title="Non Commercial">NC</abbr>-<abbr lang="en" title="Share Alike">SA</abbr></a>.
				</small>

				<meta itemprop="jobTitle" content="Webdesigner et intÃ©grateur web">
				<meta itemprop="worksFor" content="onepoint">
			</footer><!-- / contentinfo -->
		</div>
	</body>
</html>
